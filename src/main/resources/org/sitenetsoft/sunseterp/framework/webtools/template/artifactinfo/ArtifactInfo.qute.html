{!
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
!}

{#if sessionAttributes.recentArtifactInfoList && sessionAttributes.recentArtifactInfoList.size() > 0}
  <div class="right">
    <h2>Recently Viewed Artifacts:</h2>
    {#set highRef = sessionAttributes.recentArtifactInfoList.size() - 1}
    {#if highRef > 19}
      {#set highRef = 19}
    {/if}
    {#for recentArtifactInfo in sessionAttributes.recentArtifactInfoList[0..highRef]}
        <div>{count} - {recentArtifactInfo.type}:
            <a href="/artifact/{recentArtifactInfo.type}/{recentArtifactInfo.uniqueId}">{recentArtifactInfo.displayName}</a>
        </div>
        {#set count = count + 1}
    {/for}
  </div>
{/if}

{#if artifactInfo == null}

    <#-- add form here to specify artifact info name. -->
    <div>
      <form name="ArtifactInfoByName" method="post" action="<@ofbizUrl>ArtifactInfo</@ofbizUrl>" class="basic-form">
        <table class="basic-table" cellspacing="0">
            <tbody>
              <tr>
                <td class="label">
                <label>{uiLabelMap.WebtoolsSearchLocName}</label>
                </td>
                <td>
                  <input type="text" name="name" value="{parameters.name ?: ''}" size="40"/>
        <select name="type">
          <option></option>
          <option>entity</option>
          <option>service</option>
          <option>form</option>
          <option>screen</option>
          <option>request</option>
          <option>view</option>
        </select>
                </td>
                </tr>
            <tr>
                <td class="label"></td>
                <td colspan="4">
                    <input type="hidden" name="findType" value="search"/>
                    <input type="submit" name="submitButton" value="Find"/>
                </td>
            </tr>
            </tbody>
        </table>
      </form>
    </div>
    <div>
      <form name="ArtifactInfoByNameAndType" method="post" action="<@ofbizUrl>ArtifactInfo</@ofbizUrl>" class="basic-form">
        <table class="basic-table" cellspacing="0">
            <tbody>
              <tr>
                <td class="label">
                    <label>Name</label>
                </td>
                <td>
                    <input type="text" name="name" value="{parameters.name ?: ''}" size="40"/></div>
                </td>
                </tr>
                <tr>
                <td class="label">
                    <label>{uiLabelMap.WebtoolsLocation}</label>
                </td>
                <td>
                    <input type="text" name="location" value="{parameters.location ?: ''}" size="60"/></div>
                </td>
                </tr>
                <tr>
                <td class="label">
                    <label>{uiLabelMap.WebtoolsType}</label>
                </td>
                <td>
                  <select name="type">
                    <option>entity</option>
                    <option>service</option>
                    <option>form</option>
                    <option>screen</option>
                    <option>request</option>
                    <option>view</option>
                  </select>
                </td>
              </tr>
            <tr>
                <td class="label"></td>
                <td colspan="4">
                  <input type="submit" name="submitButton" value="Lookup"/>
                </td>
            </tr>
            </tbody>
        </table>
      </form>
    </div>

    <#-- add set of ArtifactInfo if there is not a single one identified, with link to each -->
    <#if artifactInfoSet?has_content>
    <div>
        <h4>Multiple Artifacts Found:</h4>
        {#for curArtifactInfo in artifactInfoSet}
            <div>{curArtifactInfo.displayType}:
                <!-- Assuming displayArtifactInfo is a Qute template fragment -->
                {#insert displayArtifactInfo artifactInfo=curArtifactInfo /}
            </div>
        {/for}
    </div>
    {/if}

{#else}

    <h1>{uiLabelMap.WebtoolsArtifactInfo} ({artifactInfo.displayType}): {artifactInfo.displayName}</h1>
    {#if artifactInfo.locationURL}
        <div>Defined in: <a href="{artifactInfo.locationURL}">{artifactInfo.locationURL}</a></div>
    {/if}

    {#if artifactInfo.type == 'entity'}
        <div><a href="{ofbizUrl}entity/find/{artifactInfo.modelEntity.entityName}?noConditionFind=Y">All Entity Data</a></div>
        <h2>Entity Fields</h2>
        <table>
        {#for modelField in artifactInfo.modelEntity.fieldsUnmodifiable}
            <tr><td>{modelField.name}{#if modelField.isPk}*{/if}</td><td>{modelField.type}</td><td>{modelField.description ?: ''}</td></tr>
        {/for}
        </table>

        <div>
        <h2>Entities Related (One)</h2>
        {#if artifactInfo.entitiesRelatedOne}
            {#for entityArtifactInfo in artifactInfo.entitiesRelatedOne}
                <!-- Assuming displayEntityArtifactInfo is a defined template fragment -->
                {#insert displayEntityArtifactInfo entityArtifactInfo=entityArtifactInfo /}
            {/for}
        {/if}
        </div>

        <div>
        <h2>Entities Related (Many)</h2>
        {#if artifactInfo.entitiesRelatedMany}
            {#for entityArtifactInfo in artifactInfo.entitiesRelatedMany}
                {#insert displayEntityArtifactInfo entityArtifactInfo=entityArtifactInfo /}
            {/for}
        {/if}
        </div>

        <div>
        <h2>Services Using This Entity</h2>
        {#if artifactInfo.servicesUsingEntity}
            {#for serviceArtifactInfo in artifactInfo.servicesUsingEntity}
                {#insert displayServiceArtifactInfo serviceArtifactInfo=serviceArtifactInfo /}
            {/for}
        {/if}
        </div>

        <div>
        <h2>Forms Using This Entity</h2>
        {#if artifactInfo.formsUsingEntity}
            {#for formWidgetArtifactInfo in artifactInfo.formsUsingEntity}
                {#insert displayFormWidgetArtifactInfo formWidgetArtifactInfo=formWidgetArtifactInfo /}
            {/for}
        {/if}
        </div>

        <div>
        <h2>Screens Using This Entity</h2>
        {#if artifactInfo.screensUsingEntity}
            {#for screenWidgetArtifactInfo in artifactInfo.screensUsingEntity}
                {#insert displayScreenWidgetArtifactInfo screenWidgetArtifactInfo=screenWidgetArtifactInfo /}
            {/for}
        {/if}
        </div>
    {/if}

    {#if artifactInfo.type == 'service'}
        <h2>Service Info</h2>
        <div>&nbsp;Description: {artifactInfo.modelService.description}</div>
        <div>&nbsp;Run ({artifactInfo.modelService.engineName}): {artifactInfo.modelService.location} :: {artifactInfo.modelService.invoke}</div>
        <div>&nbsp;Impl Location: <a href="{artifactInfo.implementationLocationURL}">{artifactInfo.implementationLocationURL}</a></div>
        <h2>Service Parameters</h2>
        <table>
            <tr><td>Name</td><td>Type</td><td>Optional</td><td>Mode</td><td>Entity.field</td></tr>
            {#for paramName in artifactInfo.modelService.allParamNames}
                {#set modelParam = artifactInfo.modelService.getParam(paramName)}
                <tr>
                    <td>{modelParam.name}{#if modelParam.internal} (internal){/if}</td>
                    <td>{modelParam.type}</td>
                    <td>{#if modelParam.optional}optional{#else}required{/if}</td>
                    <td>{modelParam.mode}</td>
                    <td>{modelParam.entityName ?: ''}.{modelParam.fieldName ?: ''}</td>
                </tr>
            {/for}
        </table>

        <div>
            <h2>Entities Used By This Service</h2>
            {#if artifactInfo.entitiesUsedByService}
                {#for entityArtifactInfo in artifactInfo.entitiesUsedByService}
                    {#insert displayEntityArtifactInfo entityArtifactInfo=entityArtifactInfo /}
                {/for}
            {/if}
        </div>

        <div>
            <h2>Services Calling This Service</h2>
            {#if artifactInfo.servicesCallingService}
                {#for serviceArtifactInfo in artifactInfo.servicesCallingService}
                    {#insert displayServiceArtifactInfo serviceArtifactInfo=serviceArtifactInfo /}
                {/for}
            {/if}
        </div>

        <div>
            <h2>Services Called By This Service</h2>
            {#if artifactInfo.servicesCalledByService}
                {#for serviceArtifactInfo in artifactInfo.servicesCalledByService}
                    {#insert displayServiceArtifactInfo serviceArtifactInfo=serviceArtifactInfo /}
                {/for}
            {/if}
        </div>

        <div>
            <h2>Service ECA Rules Triggered By This Service</h2>
            {#if artifactInfo.serviceEcaRulesTriggeredByService}
                {#for serviceEcaArtifactInfo in artifactInfo.serviceEcaRulesTriggeredByService}
                    {#insert displayServiceEcaArtifactInfo serviceEcaArtifactInfo=serviceEcaArtifactInfo /}
                {/for}
            {/if}
        </div>

        <div>
            <h2>Service ECA Rules Calling This Service</h2>
            {#if artifactInfo.serviceEcaRulesCallingService}
                {#for serviceEcaArtifactInfo in artifactInfo.serviceEcaRulesCallingService}
                    {#insert displayServiceEcaArtifactInfo serviceEcaArtifactInfo=serviceEcaArtifactInfo /}
                {/for}
            {/if}
        </div>

        <div>
            <h2>Forms Calling This Service</h2>
            {#if artifactInfo.formsCallingService}
                {#for formWidgetArtifactInfo in artifactInfo.formsCallingService}
                    {#insert displayFormWidgetArtifactInfo formWidgetArtifactInfo=formWidgetArtifactInfo /}
                {/for}
            {/if}
        </div>

        <div>
            <h2>Forms Based On This Service</h2>
            {#if artifactInfo.formsBasedOnService}
                {#for formWidgetArtifactInfo in artifactInfo.formsBasedOnService}
                    {#insert displayFormWidgetArtifactInfo formWidgetArtifactInfo=formWidgetArtifactInfo /}
                {/for}
            {/if}
        </div>

        <div>
            <h2>Screens Calling This Service</h2>
            {#if artifactInfo.screensCallingService}
                {#for screenWidgetArtifactInfo in artifactInfo.screensCallingService}
                    {#insert displayScreenWidgetArtifactInfo screenWidgetArtifactInfo=screenWidgetArtifactInfo /}
                {/for}
            {/if}
        </div>

        <div>
            <h2>Requests with Events That Call This Service</h2>
            {#if artifactInfo.requestsWithEventCallingService}
                {#for controllerRequestArtifactInfo in artifactInfo.requestsWithEventCallingService}
                    {#insert displayControllerRequestArtifactInfo controllerRequestArtifactInfo=controllerRequestArtifactInfo /}
                {/for}
            {/if}
        </div>
    {/if}

    {#if artifactInfo.type == 'form'}
        <div>
            <h2>Form Extended by This Form</h2>
            {#if artifactInfo.formThisFormExtends}
                {#insert displayFormWidgetArtifactInfo formWidgetArtifactInfo=artifactInfo.formThisFormExtends /}
            {/if}
        </div>

        <div>
            <h2>Entities Used in This Form</h2>
            {#for entityArtifactInfo in artifactInfo.entitiesUsedInForm}
                {#insert displayEntityArtifactInfo entityArtifactInfo=entityArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Services Used in This Form</h2>
            {#for serviceArtifactInfo in artifactInfo.servicesUsedInForm}
                {#insert displayServiceArtifactInfo serviceArtifactInfo=serviceArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Forms Extending This Form</h2>
            {#for formWidgetArtifactInfo in artifactInfo.formsExtendingThisForm}
                {#insert displayFormWidgetArtifactInfo formWidgetArtifactInfo=formWidgetArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Screens Including This Form</h2>
            {#for screenWidgetArtifactInfo in artifactInfo.screensIncludingThisForm}
                {#insert displayScreenWidgetArtifactInfo screenWidgetArtifactInfo=screenWidgetArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Controller Requests That Are Linked to in This Form</h2>
            {#for controllerRequestArtifactInfo in artifactInfo.requestsLinkedToInForm}
                {#insert displayControllerRequestArtifactInfo controllerRequestArtifactInfo=controllerRequestArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Controller Requests That Are Targeted By This Form</h2>
            {#for controllerRequestArtifactInfo in artifactInfo.requestsTargetedByForm}
                {#insert displayControllerRequestArtifactInfo controllerRequestArtifactInfo=controllerRequestArtifactInfo /}
            {/for}
        </div>
    {/if}

    {#if artifactInfo.type == 'screen'}
        <div>
            <h2>Entities Used in This Screen</h2>
            {#for entityArtifactInfo in artifactInfo.entitiesUsedInScreen}
                {#insert displayEntityArtifactInfo entityArtifactInfo=entityArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Services Used in This Screen</h2>
            {#for serviceArtifactInfo in artifactInfo.servicesUsedInScreen}
                {#insert displayServiceArtifactInfo serviceArtifactInfo=serviceArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Forms Included in This Screen</h2>
            {#for formWidgetArtifactInfo in artifactInfo.formsIncludedInScreen}
                {#insert displayFormWidgetArtifactInfo formWidgetArtifactInfo=formWidgetArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Screens Include in This Screen</h2>
            {#for screenWidgetArtifactInfo in artifactInfo.screensIncludedInScreen}
                {#insert displayScreenWidgetArtifactInfo screenWidgetArtifactInfo=screenWidgetArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Screens Including This Screen</h2>
            {#for screenWidgetArtifactInfo in artifactInfo.screensIncludingThisScreen}
                {#insert displayScreenWidgetArtifactInfo screenWidgetArtifactInfo=screenWidgetArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Controller Requests That Are Linked to in This Screen</h2>
            {#for controllerRequestArtifactInfo in artifactInfo.requestsLinkedToInScreen}
                {#insert displayControllerRequestArtifactInfo controllerRequestArtifactInfo=controllerRequestArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Controller Views Referring to This Screen</h2>
            {#for controllerViewArtifactInfo in artifactInfo.viewsReferringToScreen}
                {#insert displayControllerViewArtifactInfo controllerViewArtifactInfo=controllerViewArtifactInfo /}
            {/for}
        </div>
    {/if}


    {#if artifactInfo.type == 'request'}
        {#if artifactInfo.serviceCalledByRequestEvent}
            <div>
                <h2>Service Called by Request Event</h2>
                {#insert displayServiceArtifactInfo serviceArtifactInfo=artifactInfo.serviceCalledByRequestEvent /}
            </div>
        {/if}

        <div>
            <h2>Forms Referring to This Request</h2>
            {#for formWidgetArtifactInfo in artifactInfo.formInfosReferringToRequest}
                {#insert displayFormWidgetArtifactInfo formWidgetArtifactInfo=formWidgetArtifactInfo /}
            {/for}
        </div>
        <div>
            <h2>Forms Targeting This Request</h2>
            {#for formWidgetArtifactInfo in artifactInfo.formInfosTargetingRequest}
                {#insert displayFormWidgetArtifactInfo formWidgetArtifactInfo=formWidgetArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Screens Referring to This Request</h2>
            {#for screenWidgetArtifactInfo in artifactInfo.screenInfosReferringToRequest}
                {#insert displayScreenWidgetArtifactInfo screenWidgetArtifactInfo=screenWidgetArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Requests That Are Responses to This Request</h2>
            {#for controllerRequestArtifactInfo in artifactInfo.requestsThatAreResponsesToThisRequest}
                {#insert displayControllerRequestArtifactInfo controllerRequestArtifactInfo=controllerRequestArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Requests That This Request is a Response To</h2>
            {#for controllerRequestArtifactInfo in artifactInfo.requestsThatThisRequestIsResponseTo} <!-- Assuming there's a typo in the original method name -->
                {#insert displayControllerRequestArtifactInfo controllerRequestArtifactInfo=controllerRequestArtifactInfo /}
            {/for}
        </div>

        <div>
            <h2>Controller Views That Are Responses to This Request</h2>
            {#for controllerViewArtifactInfo in artifactInfo.viewsThatAreResponsesToThisRequest}
                {#insert displayControllerViewArtifactInfo controllerViewArtifactInfo=controllerViewArtifactInfo /}
            {/for}
        </div>
    {/if}


    {#if artifactInfo.type == 'view'}
        <div>
            <h2>Requests That This View is a Response To</h2>
            {#for controllerRequestArtifactInfo in artifactInfo.requestsThatThisViewIsResponseTo}
                {#insert displayControllerRequestArtifactInfo controllerRequestArtifactInfo=controllerRequestArtifactInfo /}
            {/for}
        </div>

        {#if artifactInfo.screenCalledByThisView}
            <div>
                <h2>Screen Called by This View</h2>
                {#insert displayScreenWidgetArtifactInfo screenWidgetArtifactInfo=artifactInfo.screenCalledByThisView /}
            </div>
        {/if}
    {/if}


<#-- ==================== MACROS ===================== -->
<#macro displayEntityArtifactInfo entityArtifactInfo>
    <div>&nbsp;-&nbsp;<@displayArtifactInfo artifactInfo=entityArtifactInfo/></div>
</#macro>

<#macro displayServiceArtifactInfo serviceArtifactInfo>
    <div>&nbsp;-&nbsp;<@displayArtifactInfo artifactInfo=serviceArtifactInfo/></div>
</#macro>

<#macro displayServiceEcaArtifactInfo serviceEcaArtifactInfo>
    <h4>Service ECA Rule: {serviceEcaArtifactInfo.getDisplayPrefixedName()}</h4>
    <#if serviceEcaArtifactInfo.serviceEcaRule.getEcaConditionList()?has_content>
        <h4>ECA Rule Conditions</h4>
        <#list serviceEcaArtifactInfo.serviceEcaRule.getEcaConditionList() as ecaCondition>
            <div>&nbsp;-&nbsp;{ecaCondition.getShortDisplayDescription(true)}</div>
        </#list>
    </#if>
    <#if serviceEcaArtifactInfo.serviceEcaRule.getEcaActionList()?has_content>
        <h4>ECA Rule Actions</h4>
        <table>
        <#list serviceEcaArtifactInfo.serviceEcaRule.getEcaActionList() as ecaAction>
            <tr>
                <td><a href="<@ofbizUrl>ArtifactInfo?type={artifactInfo.getType()}&amp;uniqueId={ecaAction.getServiceName()}</@ofbizUrl>">{ecaAction.getServiceName()}</a></td>
                <td>{ecaAction.getServiceMode()}<#if ecaAction.isPersist()>-persisted</#if></td>
            </tr>
        </#list>
        </table>
    </#if>

    <#-- leaving this out, will show service links for actions
    <#if serviceEcaArtifactInfo.getServicesCalledByServiceEcaActions()?has_content>
        <h4>Services Called By Service ECA Actions</h4>
        <#list serviceEcaArtifactInfo.getServicesCalledByServiceEcaActions() as serviceArtifactInfo>
            <@displayServiceArtifactInfo serviceArtifactInfo=serviceArtifactInfo/>
        </#list>
    </#if>
    -->
    <#if serviceEcaArtifactInfo.getServicesTriggeringServiceEca()?has_content>
        <h4>Services Triggering Service ECA</h4>
        <#list serviceEcaArtifactInfo.getServicesTriggeringServiceEca() as serviceArtifactInfo>
            <@displayServiceArtifactInfo serviceArtifactInfo=serviceArtifactInfo/>
        </#list>
    </#if>
</#macro>

<#macro displayFormWidgetArtifactInfo formWidgetArtifactInfo>
    <div>&nbsp;-&nbsp;<@displayArtifactInfo artifactInfo=formWidgetArtifactInfo/></div>
</#macro>

<#macro displayScreenWidgetArtifactInfo screenWidgetArtifactInfo>
    <div>&nbsp;-&nbsp;<@displayArtifactInfo artifactInfo=screenWidgetArtifactInfo/></div>
</#macro>

<#macro displayControllerRequestArtifactInfo controllerRequestArtifactInfo>
    <div>&nbsp;-&nbsp;<@displayArtifactInfo artifactInfo=controllerRequestArtifactInfo/></div>
</#macro>

<#macro displayControllerViewArtifactInfo controllerViewArtifactInfo>
    <div>&nbsp;-&nbsp;<@displayArtifactInfo artifactInfo=controllerViewArtifactInfo/></div>
</#macro>

<#macro displayArtifactInfo artifactInfo>
    <@displayArtifactInfoLink type=artifactInfo.getType() uniqueId=artifactInfo.getUniqueId() displayName=artifactInfo.getDisplayName()/>
</#macro>

<#macro displayArtifactInfoLink type uniqueId displayName>
<a href="<@ofbizUrl>ArtifactInfo?type={type}&amp;uniqueId={uniqueId?url('ISO-8859-1')}</@ofbizUrl>">{displayName}</a>
</#macro>
